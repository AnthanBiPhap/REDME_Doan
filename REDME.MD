# Cấu trúc cơ sở dữ liệu cho Trang Web Thương Mại Điện Tử

## 1. Users
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints                            | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|----------------------------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                                        | Auto-generated by MongoDB         |
| 2   | `userName`       | String       | 50   | No         |               |                  |                                        | User login name                   |
| 3   | `fullName`       | String       | 100  | No         |               |                  |                                        | User's full name                  |
| 4   | `email`          | String       | 100  | No         | Unique        |                  | Valid email format                     | User's email                      |
| 5   | `password`       | String       | 255  | No         |               |                  |                                        | Encrypted password (hashed via bcrypt) |
| 6   | `roles`          | String       | 50   | No         |               | "customer"       |                                        | Role of user (e.g., "customer", "restaurantOwner", "admin") |
| 7   | `status`         | String       | -    | No         |               | "active"         | ENUM("active", "inactive", "banned")   | Account status                    |
| 8   | `avatarUrl`      | String       | 255  | Yes        |               |                  |                                        | Avatar image URL                  |
| 9   | `lastLogin`      | Date         | -    | Yes        |               |                  |                                        | Last login time                   |
| 10  | `gender`         | String       | -    | Yes        |               |                  | ENUM("male", "female")                 | User's gender                     |
| 11  | `phone`          | String       | 20   | Yes        | Unique        |                  |                                        | User's phone number               |
| 12  | `birthDay`       | Date         | -    | Yes        |               |                  |                                        | User's birthday                   |
| 13  | `createdAt`      | Date         | -    | No         |               | CURRENT          |                                        | Account creation time (auto by timestamps) |
| 14  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                                        | Last update time (auto by timestamps) |

### Ghi chú
- **Mã hóa mật khẩu**: Mật khẩu được mã hóa bằng `bcrypt` với `saltRounds = 10` trước khi lưu vào cơ sở dữ liệu (sử dụng middleware `pre('save')`).
- **Email**: Được kiểm tra định dạng hợp lệ bằng regex trong schema.
- **Timestamps**: Các trường `createdAt` và `updatedAt` được tự động quản lý bởi Mongoose thông qua tùy chọn `{ timestamps: true }`.
- **Roles**: Chỉ định vai trò người dùng, mặc định là `"customer"`.

## 2. Categories
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `name`           | String       | 100  | No         |               |                  |                  | Category name                     |
| 3   | `description`    | String       | 500  | Yes        |               |                  |                  | Category description              |
| 4   | `slug`           | String       | 120  | No         | Unique        |                  |                  | SEO friendly URL                  |
| 5   | `parentId`       | ObjectId     | -    | Yes        | Foreign Key   |                  |                  | Reference to parent category      |
| 6   | `level`          | Number       | -    | No         |               | 0                |                  | Category hierarchy level          |
| 7   | `imageUrl`       | String       | 255  | Yes        |               |                  |                  | Category image                    |
| 8   | `isActive`       | Boolean      | -    | No         |               | true             |                  | Category status                   |
| 9   | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation timestamp                |
| 10  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 3. Products
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `name`           | String       | 255  | No         |               |                  |                  | Product name                      |
| 3   | `description`    | String       | 2000 | Yes        |               |                  |                  | Product description               |
| 4   | `slug`           | String       | 300  | No         | Unique        |                  |                  | SEO friendly URL                  |
| 5   | `categoryId`     | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to category             |
| 6   | `price`          | Number       | -    | No         |               |                  | >= 0             | Product price                     |
| 7   | `salePrice`      | Number       | -    | Yes        |               |                  | >= 0             | Discounted price                  |
| 8   | `stock`          | Number       | -    | No         |               | 0                | >= 0             | Available inventory               |
| 9   | `images`         | [String]     | -    | No         |               | []               |                  | Array of image URLs               |
| 10  | `vendorId`       | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to vendor               |
| 11  | `attributes`     | Object       | -    | Yes        |               |                  |                  | Product attributes (color, size...) |
| 12  | `rating`         | Number       | -    | No         |               | 0                | 0-5              | Average product rating            |
| 13  | `reviewCount`    | Number       | -    | No         |               | 0                | >= 0             | Number of reviews                 |
| 14  | `tags`           | [String]     | -    | Yes        |               | []               |                  | Product tags                      |
| 15  | `isActive`       | Boolean      | -    | No         |               | true             |                  | Product availability status       |
| 16  | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation timestamp                |
| 17  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 4. Orders
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `orderNumber`    | String       | 50   | No         | Unique        |                  |                  | Unique order identifier           |
| 3   | `userId`         | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to user                 |
| 4   | `products`       | [Object]     | -    | No         |               | []               |                  | Array of ordered products         |
| 5   | `totalAmount`    | Number       | -    | No         |               | 0                | >= 0             | Total order amount                |
| 6   | `shippingFee`    | Number       | -    | No         |               | 0                | >= 0             | Shipping cost                     |
| 7   | `tax`            | Number       | -    | No         |               | 0                | >= 0             | Tax amount                        |
| 8   | `discount`       | Number       | -    | No         |               | 0                | >= 0             | Discount amount                   |
| 9   | `paymentMethod`  | String       | 50   | No         |               |                  | ENUM("credit_card", "paypal", "cod") | Payment method |
| 10  | `paymentStatus`  | String       | 20   | No         |               | "pending"        | ENUM("pending", "paid", "failed")    | Payment status |
| 11  | `shippingAddress`| Object       | -    | No         |               |                  |                  | Shipping address details          |
| 12  | `status`         | String       | 20   | No         |               | "pending"        | ENUM("pending", "processing", "shipped", "delivered", "cancelled") | Order status |
| 13  | `notes`          | String       | 500  | Yes        |               |                  |                  | Additional order notes            |
| 14  | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Order date                        |
| 15  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 5. Reviews
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `productId`      | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to product              |
| 3   | `userId`         | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to user                 |
| 4   | `rating`         | Number       | -    | No         |               |                  | 1-5              | Star rating                       |
| 5   | `title`          | String       | 100  | Yes        |               |                  |                  | Review title                      |
| 6   | `comment`        | String       | 1000 | No         |               |                  |                  | Review comment                    |
| 7   | `images`         | [String]     | -    | Yes        |               | []               |                  | Review images                     |
| 8   | `isVerified`     | Boolean      | -    | No         |               | false            |                  | Verified purchase flag            |
| 9   | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Review date                       |
| 10  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 6. Cart
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `userId`         | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to user                 |
| 3   | `items`          | [Object]     | -    | No         |               | []               |                  | Cart items                        |
| 4   | `totalAmount`    | Number       | -    | No         |               | 0                | >= 0             | Total cart amount                 |
| 5   | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation timestamp                |
| 6   | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 7. Vendors
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `userId`         | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to user                 |
| 3   | `companyName`    | String       | 100  | No         |               |                  |                  | Vendor's company name             |
| 4   | `description`    | String       | 1000 | Yes        |               |                  |                  | Company description               |
| 5   | `logoUrl`        | String       | 255  | Yes        |               |                  |                  | Company logo URL                  |
| 6   | `coverImageUrl`  | String       | 255  | Yes        |               |                  |                  | Cover image URL                   |
| 7   | `address`        | Object       | -    | No         |               |                  |                  | Company address                   |
| 8   | `contactPhone`   | String       | 20   | No         |               |                  |                  | Contact phone number              |
| 9   | `contactEmail`   | String       | 100  | No         |               |                  |                  | Contact email                     |
| 10  | `website`        | String       | 255  | Yes        |               |                  |                  | Company website                   |
| 11  | `socialLinks`    | Object       | -    | Yes        |               |                  |                  | Social media links                |
| 12  | `rating`         | Number       | -    | No         |               | 0                | 0-5              | Average vendor rating             |
| 13  | `status`         | String       | 20   | No         |               | "pending"        | ENUM("pending", "active", "suspended") | Vendor status |
| 14  | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Registration date                 |
| 15  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 8. Payments
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `orderId`        | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to order                |
| 3   | `userId`         | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to user                 |
| 4   | `amount`         | Number       | -    | No         |               | 0                | > 0              | Payment amount                    |
| 5   | `method`         | String       | 50   | No         |               |                  | ENUM("credit_card", "paypal", "cod") | Payment method |
| 6   | `status`         | String       | 20   | No         |               | "pending"        | ENUM("pending", "completed", "failed", "refunded") | Payment status |
| 7   | `transactionId`  | String       | 100  | Yes        |               |                  |                  | External transaction ID           |
| 8   | `gateway`        | String       | 50   | Yes        |               |                  |                  | Payment gateway used              |
| 9   | `metadata`       | Object       | -    | Yes        |               |                  |                  | Additional payment data           |
| 10  | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Payment date                      |
| 11  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 9. Wishlist
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `userId`         | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to user                 |
| 3   | `productId`      | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to product              |
| 4   | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Item addition date                |

## 10. Coupons
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `code`           | String       | 50   | No         | Unique        |                  |                  | Coupon code                       |
| 3   | `type`           | String       | 20   | No         |               |                  | ENUM("percentage", "fixed") | Discount type              |
| 4   | `value`          | Number       | -    | No         |               |                  | > 0              | Discount value                    |
| 5   | `minPurchase`    | Number       | -    | Yes        |               | 0                | >= 0             | Minimum purchase amount            |
| 6   | `startDate`      | Date         | -    | No         |               |                  |                  | Validity start date               |
| 7   | `endDate`        | Date         | -    | No         |               |                  |                  | Validity end date                 |
| 8   | `usageLimit`     | Number       | -    | Yes        |               |                  | >= 0             | Maximum usage count               |
| 9   | `usageCount`     | Number       | -    | No         |               | 0                | >= 0             | Current usage count               |
| 10  | `isActive`       | Boolean      | -    | No         |               | true             |                  | Coupon status                     |
| 11  | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation date                     |
| 12  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |


## 11. Addresses
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `userId`         | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to user                 |
| 3   | `type`           | String       | 20   | No         |               |                  | ENUM("shipping", "billing") | Address type           |
| 4   | `fullName`       | String       | 100  | No         |               |                  |                  | Recipient's full name             |
| 5   | `phoneNumber`    | String       | 20   | No         |               |                  |                  | Contact phone number              |
| 6   | `addressLine1`   | String       | 255  | No         |               |                  |                  | Address line 1                    |
| 7   | `addressLine2`   | String       | 255  | Yes        |               |                  |                  | Address line 2                    |
| 8   | `city`           | String       | 100  | No         |               |                  |                  | City                              |
| 9   | `state`          | String       | 100  | No         |               |                  |                  | State/Province                    |
| 10  | `postalCode`     | String       | 20   | No         |               |                  |                  | Zip/Postal code                   |
| 11  | `country`        | String       | 100  | No         |               |                  |                  | Country                           |
| 12  | `isDefault`      | Boolean      | -    | No         |               | false            |                  | Default address flag              |
| 13  | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation timestamp                |
| 14  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 12. Shipping
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `orderId`        | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to order                |
| 3   | `carrier`        | String       | 100  | No         |               |                  |                  | Shipping carrier                  |
| 4   | `trackingNumber` | String       | 100  | Yes        |               |                  |                  | Tracking code                     |
| 5   | `status`         | String       | 20   | No         |               | "processing"     | ENUM("processing", "shipped", "delivered", "failed") | Shipping status |
| 6   | `estimatedDelivery` | Date      | -    | Yes        |               |                  |                  | Expected delivery date            |
| 7   | `actualDelivery` | Date         | -    | Yes        |               |                  |                  | Actual delivery date              |
| 8   | `shippingMethod` | String       | 50   | No         |               |                  |                  | Shipping method                   |
| 9   | `shippingFee`    | Number       | -    | No         |               | 0                | >= 0             | Shipping cost                     |
| 10  | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation timestamp                |
| 11  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 13. Notifications
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `userId`         | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to user                 |
| 3   | `type`           | String       | 50   | No         |               |                  | ENUM("order", "payment", "account", "promotion") | Notification type |
| 4   | `title`          | String       | 100  | No         |               |                  |                  | Notification title                |
| 5   | `message`        | String       | 500  | No         |               |                  |                  | Notification content              |
| 6   | `metadata`       | Object       | -    | Yes        |               |                  |                  | Additional data                   |
| 7   | `isRead`         | Boolean      | -    | No         |               | false            |                  | Read status                       |
| 8   | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation timestamp                |

## 14. ProductVariants
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `productId`      | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to product              |
| 3   | `sku`            | String       | 50   | No         | Unique        |                  |                  | Stock keeping unit                |
| 4   | `variantName`    | String       | 100  | No         |               |                  |                  | Variant display name              |
| 5   | `attributes`     | Object       | -    | No         |               |                  |                  | Color, size, material, etc.       |
| 6   | `price`          | Number       | -    | No         |               |                  | >= 0             | Variant price                     |
| 7   | `salePrice`      | Number       | -    | Yes        |               |                  | >= 0             | Discounted price                  |
| 8   | `stock`          | Number       | -    | No         |               | 0                | >= 0             | Available inventory               |
| 9   | `images`         | [String]     | -    | Yes        |               | []               |                  | Variant-specific images           |
| 10  | `isActive`       | Boolean      | -    | No         |               | true             |                  | Variant availability              |
| 11  | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation timestamp                |
| 12  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 15. ProductInventory
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `productId`      | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to product              |
| 3   | `variantId`      | ObjectId     | -    | Yes        | Foreign Key   |                  |                  | Reference to variant (if applicable) |
| 4   | `quantity`       | Number       | -    | No         |               | 0                | >= 0             | Available quantity                |
| 5   | `reservedQuantity` | Number     | -    | No         |               | 0                | >= 0             | Reserved for processing orders    |
| 6   | `locationId`     | ObjectId     | -    | Yes        | Foreign Key   |                  |                  | Reference to warehouse location   |
| 7   | `lowStockThreshold` | Number    | -    | Yes        |               |                  | >= 0             | Low stock alert threshold         |
| 8   | `lastRestocked`  | Date         | -    | Yes        |               |                  |                  | Last restock date                 |
| 9   | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation timestamp                |
| 10  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 16. Settings
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `key`            | String       | 100  | No         | Unique        |                  |                  | Setting key                       |
| 3   | `value`          | Mixed        | -    | No         |               |                  |                  | Setting value                     |
| 4   | `type`           | String       | 20   | No         |               |                  | ENUM("string", "number", "boolean", "object", "array") | Value type |
| 5   | `group`          | String       | 50   | No         |               |                  |                  | Settings group                    |
| 6   | `isPublic`       | Boolean      | -    | No         |               | false            |                  | Publicly accessible flag          |
| 7   | `description`    | String       | 255  | Yes        |               |                  |                  | Setting description               |
| 8   | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation timestamp                |
| 9   | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 17. ProductAttributes
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `name`           | String       | 50   | No         | Unique        |                  |                  | Attribute name                    |
| 3   | `displayName`    | String       | 100  | No         |               |                  |                  | Display name                      |
| 4   | `description`    | String       | 255  | Yes        |               |                  |                  | Attribute description             |
| 5   | `type`           | String       | 20   | No         |               |                  | ENUM("text", "number", "boolean", "select") | Value type |
| 6   | `options`        | [String]     | -    | Yes        |               |                  |                  | Possible values for select type   |
| 7   | `isFilterable`   | Boolean      | -    | No         |               | false            |                  | Can be used as filter             |
| 8   | `isVariant`      | Boolean      | -    | No         |               | false            |                  | Used for product variants         |
| 9   | `isRequired`     | Boolean      | -    | No         |               | false            |                  | Required for product creation     |
| 10  | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation timestamp                |
| 11  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 18. PaymentMethods
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `userId`         | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to user                 |
| 3   | `type`           | String       | 20   | No         |               |                  | ENUM("credit_card", "paypal", "bank_account") | Payment method type |
| 4   | `provider`       | String       | 50   | No         |               |                  |                  | Payment provider                  |
| 5   | `accountNumber`  | String       | 50   | Yes        |               |                  |                  | Last 4 digits for cards           |
| 6   | `expiryDate`     | Date         | -    | Yes        |               |                  |                  | For credit cards                  |
| 7   | `cardholderName` | String       | 100  | Yes        |               |                  |                  | For credit cards                  |
| 8   | `billingAddress` | Object       | -    | Yes        |               |                  |                  | Billing address                   |
| 9   | `isDefault`      | Boolean      | -    | No         |               | false            |                  | Default payment method            |
| 10  | `metadata`       | Object       | -    | Yes        |               |                  |                  | Additional data                   |
| 11  | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation timestamp                |
| 12  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## 19. ActivityLog
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `userId`         | ObjectId     | -    | Yes        | Foreign Key   |                  |                  | Reference to user                 |
| 3   | `action`         | String       | 50   | No         |               |                  |                  | Action performed                  |
| 4   | `entityType`     | String       | 50   | No         |               |                  |                  | Entity type (user, product, order) |
| 5   | `entityId`       | ObjectId     | -    | Yes        |               |                  |                  | Reference to entity               |
| 6   | `description`    | String       | 255  | No         |               |                  |                  | Activity description              |
| 7   | `metadata`       | Object       | -    | Yes        |               |                  |                  | Additional data                   |
| 8   | `ipAddress`      | String       | 50   | Yes        |               |                  |                  | User IP address                   |
| 9   | `userAgent`      | String       | 255  | Yes        |               |                  |                  | User agent info                   |
| 10  | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation timestamp                |

## 20. SEO
| No. | Field Name       | Data Type    | Size | Allow Null | Key           | Default Value    | Constraints      | Notes                             |
|-----|------------------|--------------|------|------------|---------------|------------------|------------------|-----------------------------------|
| 1   | `id`             | ObjectId     | -    | No         | Primary Key   |                  |                  | Auto-generated by MongoDB         |
| 2   | `entityType`     | String       | 50   | No         |               |                  | ENUM("product", "category", "vendor", "page") | Related entity type |
| 3   | `entityId`       | ObjectId     | -    | No         | Foreign Key   |                  |                  | Reference to entity               |
| 4   | `metaTitle`      | String       | 100  | Yes        |               |                  |                  | SEO title                         |
| 5   | `metaDescription`| String       | 200  | Yes        |               |                  |                  | SEO description                   |
| 6   | `metaKeywords`   | String       | 200  | Yes        |               |                  |                  | SEO keywords                      |
| 7   | `ogTitle`        | String       | 100  | Yes        |               |                  |                  | Open Graph title                  |
| 8   | `ogDescription`  | String       | 200  | Yes        |               |                  |                  | Open Graph description            |
| 9   | `ogImage`        | String       | 255  | Yes        |               |                  |                  | Open Graph image URL              |
| 10  | `canonicalUrl`   | String       | 255  | Yes        |               |                  |                  | Canonical URL                     |
| 11  | `createdAt`      | Date         | -    | No         |               | CURRENT          |                  | Creation timestamp                |
| 12  | `updatedAt`      | Date         | -    | No         |               | CURRENT          |                  | Last update timestamp             |

## Relational Schema

The following diagram represents the key relationships between the main collections:

```
Users 1-->* Orders
Users 1-->* Reviews
Users 1-->* Addresses
Users 1-->* Payments
Users 1-->* Wishlist
Users 1-->1 Cart
Users 1-->1 Vendors (for vendor accounts)

Products *-->1 Categories 
Products *-->1 Vendors
Products 1-->* Reviews
Products 1-->* ProductVariants
Products 1-->* ProductInventory

Orders 1-->* OrderItems (embedded or referenced)
Orders *-->1 Users
Orders 1-->* Payments
Orders 1-->1 Shipping

Categories *-->1 Categories (parent-child relationship)
```

## Indexes for Performance Optimization

```javascript
// Users Collection
db.users.createIndex({ "email": 1 }, { unique: true });
db.users.createIndex({ "username": 1 }, { unique: true });
db.users.createIndex({ "roles": 1 });

// Products Collection
db.products.createIndex({ "slug": 1 }, { unique: true });
db.products.createIndex({ "categoryId": 1 });
db.products.createIndex({ "vendorId": 1 });
db.products.createIndex({ "name": "text", "description": "text" }); // Text search
db.products.createIndex({ "price": 1 });
db.products.createIndex({ "isActive": 1 });

// Categories Collection
db.categories.createIndex({ "slug": 1 }, { unique: true });
db.categories.createIndex({ "parentId": 1 });

// Orders Collection
db.orders.createIndex({ "userId": 1 });
db.orders.createIndex({ "orderNumber": 1 }, { unique: true });
db.orders.createIndex({ "status": 1 });
db.orders.createIndex({ "createdAt": -1 });

// Reviews Collection
db.reviews.createIndex({ "productId": 1 });
db.reviews.createIndex({ "userId": 1 });

// Coupons Collection
db.coupons.createIndex({ "code": 1 }, { unique: true });
db.coupons.createIndex({ "isActive": 1 });
db.coupons.createIndex({ "endDate": 1 });

// Cart Collection
db.cart.createIndex({ "userId": 1 }, { unique: true });

// ProductVariants Collection
db.productVariants.createIndex({ "productId": 1 });
db.productVariants.createIndex({ "sku": 1 }, { unique: true });

// Addresses Collection
db.addresses.createIndex({ "userId": 1 });
db.addresses.createIndex({ "userId": 1, "isDefault": 1 });
```
